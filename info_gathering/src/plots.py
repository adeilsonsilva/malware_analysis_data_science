#!/usr/bin/env python

##################################################
## Universidade Federal da Bahia
##################################################
## GPLv3
##################################################
## Author: Adeilson Silva
## Mmaintainer: github.com/adeilsonsilva
## Email: adeilson@protonmail.com
##################################################

import argparse
import dateutil
import os
import pandas
import subprocess
from matplotlib import pyplot

def create_plots(csv_path, output_folder):
    malware = pandas.read_csv(csv_path, dtype=str, keep_default_na=False, skipinitialspace=True)
    #print(malware)
    malware['fs_date'] = [dateutil.parser.parse(d) for d in malware['DATE']]

    # print(malware['fs_date'].to_string())
    # print("===========")
    # print(malware['MAIN_EXT'].to_string())

    # Create plots

    # Histograma das extensões
    pyplot.rcParams["figure.figsize"] = 10, 8
    malware['MAIN_EXT'].value_counts().plot.bar()
    # pyplot.hist(malware['MAIN_EXT'].value_counts(), bins='auto', alpha=1)
    pyplot.title("Histograma dos tipos de extensão principais encontradas")
    pyplot.xlabel("Extensões")
    pyplot.ylabel("Quantidade")
    # pyplot.show()
    pyplot.savefig("{}hist.svg".format(output_folder), dpi=100, format="svg")
    pyplot.clf()

    # Extensões ao longo do tempo
    pyplot.rcParams["figure.figsize"] = 10, 8
    pyplot.plot(malware['fs_date'], malware['MAIN_EXT'], 'b.', alpha=1)
    pyplot.title("Tipos de extensão principais encontradas ao longo do tempo")
    pyplot.xlabel("Datas")
    pyplot.ylabel("Extensões principais")
    # pyplot.show()
    pyplot.savefig("{}ext.svg".format(output_folder), dpi=100, format="svg")
    pyplot.clf()
